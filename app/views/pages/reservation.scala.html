
@(from:String, to:String)(implicit req: play.api.mvc.RequestHeader)

@helper.javascriptRouter("jsRoutes")(routes.javascript.Application.getDummyOffers, routes.javascript.Application.category)

<!--move javascript router to main wrapping template -->
<!DOCTYPE html>
<html lang="en">
<head>
  @views.html.commoncss.render("Бронирование")
</head>

<body class="page-reservation">

  <div class="wrapper">

    @views.html.base_top.render

    <main class="main-fluid clearfix">

      <div class="contact-box">
        <h2>Отель Екатерина</h2>
        <p>Украина, 65026, г. Одесса, ул. Греческая 25/11</p>
        <h3>Отдел бронирования:</h3>
        <p><a href="tel:+380487296701">+38 (048) 729-67-01</a></p>
        <p><a href="tel:+380671815104">+38 (067) 181-51-04</a></p>
        <h3>Рецепция:</h3>
        <p><a href="tel:+380487296703">+38 (048) 729-67-03</a></p>
        <p><a href="tel:+380487226408">+38 (048) 722-64-08</a></p>
        <p>факс: +38 (048) 729-67-08</p>
        <p><a href="mailto:booking@@hotel-ekaterina.com">Email: booking@@hotel-ekaterina.com</a></p>
        <h2>Отель Екатерина II</h2>
        <p>Украина, 65026, г. Одесса, площадь Екатерининская, 7</p>
        <h3>Отдел бронирования:</h3>
        <p><a href="tel:+380487296702">+38 (048) 729-67-02</a></p>
        <p><a href="tel:+380671815105">+38 (067) 181-51-05</a></p>
        <h3>Рецепция:</h3>
        <p><a href="tel:+380487296700">+38 (048) 729-67-00</a></p>
        <p>факс: +38 (048) 729-67-08</p>
        <p><a href="mailto:booking@@hotel-ekaterina.com">Email: booking@@hotel-ekaterina.com</a></p>
      </div>

      <section class="main-section clearfix">

        <h1>Забронируйте номер</h1>

        <form action="#" class="booking-form clearfix">

          <fieldset>
            <div class="booking-row clearfix">

              <div class="form-col">
                <label for="checkIn">Дата заселения <i class="flaticon-calendar-icons"></i></label>
                <input type="text" name="checkIn" id="checkIn" value="Дата заселения" required readonly>
              </div>

              <div class="form-col">
                <label for="checkOut">Дата выселения <i class="flaticon-calendar-icons"></i></label>
                <input type="text" name="checkOut" id="checkOut" value="Дата выселения" required readonly>
              </div>

              <div class="form-col">
                <label for="peopleQuantity">Кол-во человек</label>
                <select name="peopleQuantity" id="peopleQuantity" required>
                  <option value="1">1</option>
                  <option value="1">2</option>
                  <option value="1">3</option>
                  <option value="1">4</option>
                </select>
              </div>

              <div class="form-col">
                <label for="hotel">Отель</label>
                <select name="hotel" id="hotel" required>
                  <option value="ekaterina1">Екатерина</option>
                  <option value="ekaterina2">Екатерина II</option>
                </select>
              </div>

              <div class="form-col">
                <label for="twin">Твин</label>
                <input type="checkbox" name="twin" id="twin">
              </div>

              <div class="form-col">
                <div class="submit-button">
                  <input type="submit" value="Заказать">
                </div>
              </div>

            </div>

          </fieldset>

        </form>

      </section>



    </main>

  </div>

  @views.html.base_bottom.render(false)

  <script>

    var collectOpt = function (cat) {

      console.log('collectOpt() called');

      var breakfastChkbx = $(cat).find('.options__item--breakfast input')[0],
          eciChkbx       = $(cat).find('.options__item--early input')[0],
          lcoChkbx       = $(cat).find('.options__item--late input')[0];

      var hotelId   = cat.dataset.hotelid,
          catId     = cat.dataset.catid,
          hash      = +cat.dataset.hash,
          guestsCnt = +$(cat).find('select[name="guest"]').val(),
          roomCnt   = +$(cat).find('select[name="room_count"]').val(),
          breakfast = breakfastChkbx.checked ? true : false,
          eci       = eciChkbx.checked ? true : false,
          lco       = lcoChkbx.checked ? true : false;

      var data = JSON.stringify({
          'hotelId'  : hotelId,
          'catId'    : catId,
          'hash'     : hash,
          'guestsCnt': guestsCnt,
          'roomCnt'  : roomCnt,
          'breakfast': breakfast,
          'eci'      : eci,
          'lco'      : lco
      });

      console.log(data);

      return data;

    };

    var changingCat = function (data) {

      console.log('changingCat() called');

      var from = '20160130000000',
          to   = '20160230000000';

      $.ajax(jsRoutes.controllers.Application.category(from,to,data))
      .done(function( resp ) {
        console.log(data);
        console.log(resp);
      });

    };

    $.ajax(jsRoutes.controllers.Application.getDummyOffers(@from,@to))
      .done(function( data ) {
        $('.booking-form').after(data);

        $('select').selectric({
          responsive: true
        });

        $('.category-item').change(function(e) {

          changingCat(collectOpt(e.currentTarget));

        });

    });

  </script>

</body>
</html>
